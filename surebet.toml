# Surebet - Polymarket Trading Engine Configuration
# Secrets should be set via environment variables, not here.
# See .env.example for required env vars.

[polymarket]
clob_url = "https://clob.polymarket.com"
clob_ws_url = "wss://ws-subscriptions-clob.polymarket.com/ws/market"
rtds_ws_url = "wss://ws-live-data.polymarket.com"
gamma_url = "https://gamma-api.polymarket.com"

[filters]
# Minimum 24h volume (USDC) to consider a market
min_volume_usd = 10000.0
# Minimum liquidity depth (USDC)
min_depth_usd = 1000.0
# Maximum spread percentage
max_spread_pct = 5.0
# Categories to watch (empty = all). Examples: "crypto", "politics", "sports"
categories = []
# Categories to exclude
exclude_categories = []

[arb]
# Enable cross-outcome arb scanner
enabled = true
# Enable live execution (false = scan-only / paper mode)
execute = false
# Minimum net edge after fees to report/execute (0.005 = $0.005 per $1)
min_net_edge = 0.005
# Scan interval in milliseconds
scan_interval_ms = 1000
# Max USDC per arb position
max_position_usd = 100.0
# Max total USDC across all open positions
max_total_exposure = 500.0

[maker]
# Enable passive market-making strategy (posts bids on both sides of binary markets)
enabled = true
# Enable live execution (false = paper mode, logs orders without placing them)
execute = false
# Target bid sum as fraction of $1.00 (0.97 = $0.03 edge per round-trip)
target_bid_sum = 0.97
# Order size in shares per leg
order_size = 10.0
# Minimum spread to post into (won't make in very tight markets)
min_spread = 0.02
# Maximum inventory imbalance before pausing a side
max_inventory_imbalance = 50.0
# Requote interval in seconds
requote_interval_secs = 5
# Minimum price change to trigger a requote
requote_threshold = 0.01
# Seconds to wait for second leg fill before unwinding (leg risk timeout)
fill_timeout_secs = 30
# Fraction of spread to chase on unfilled leg after partial fill (0.0-1.0)
# 0.5 = move halfway to the ask; 1.0 = match the ask (aggressive)
aggressive_reprice_pct = 0.50
# Max seconds since last trade on an outcome before skipping that market
# Prevents posting in markets with no taker flow on one side
min_activity_age_secs = 300

[feeds]
# Enable Binance/Coinbase price feeds for Chainlink oracle prediction
enabled = false
# Binance WebSocket symbols (lowercase)
binance_symbols = ["btcusdt", "ethusdt"]
# Coinbase product IDs
coinbase_products = ["BTC-USD", "ETH-USD"]
# Max age (seconds) before a price observation is stale
max_observation_age_secs = 5

[valkey]
# Valkey/Redis connection URL (also supports VALKEY_URL env var)
url = "redis://127.0.0.1:6379"
# Key namespace prefix. Multiple instances can share one Valkey by using
# different prefixes, e.g. "surebet:paper" vs "surebet:live"
prefix = "surebet"

[dashboard]
# Enable the HTTP monitoring dashboard
enabled = true
# Dashboard bind address
bind = "127.0.0.1:3030"

[anomaly]
# Enable the anomaly detector (surfaces suspicious trades for review)
enabled = true
# Scan interval in milliseconds
scan_interval_ms = 5000
# Rolling window for trade history per asset (seconds)
window_secs = 300
# A single trade this many × the average size = "whale" trade
whale_size_multiplier = 10.0
# Volume in window must exceed this × previous window to flag "volume spike"
volume_spike_multiplier = 5.0
# Price must move this % from the rolling mean to flag "price dislocation"
price_move_pct = 10.0
# Bid/ask depth ratio threshold for "book imbalance" (5.0 = one side 5× heavier)
book_imbalance_ratio = 5.0
# Max anomalies to keep in memory for the dashboard
max_anomalies = 200

[crossbook]
# Enable the cross-bookmaker arb scanner (auto-enables if ODDS_API_KEY is set)
enabled = true
# The Odds API key is loaded from ODDS_API_KEY env var — never put it here
# Base URL for The Odds API
odds_api_url = "https://api.the-odds-api.com/v4/sports"
# Regions to fetch odds for (comma-separated: us, uk, eu, au)
regions = "uk,eu"
# Markets to fetch (comma-separated: h2h, h2h_lay, spreads, totals)
markets = "h2h,h2h_lay"
# Sports keys to monitor — keep this short to stay within API budget
# Full list: https://the-odds-api.com/sports-odds-data/sports-apis.html
sports_keys = [
    "soccer_epl",
    "soccer_spain_la_liga",
    "soccer_germany_bundesliga",
    "soccer_uefa_champs_league",
]
# How often to fetch fresh odds (seconds). 21600 = 6 hours.
# Budget math: 4 sports × 4 fetches/day × 30 days = 480 req/month
fetch_interval_secs = 21600
# How often to scan for cross-provider arbs (milliseconds)
scan_interval_ms = 5000
# Minimum edge (%) to report a cross-provider arb
min_edge_pct = 1.0
# Max results to keep for dashboard
max_results = 100
# Monthly API request budget (free tier = 500)
monthly_budget = 500
# Stop fetching when remaining requests fall to this floor
min_remaining = 50
# Polymarket volume/depth filters for crossbook matching (lower than main
# [filters] so that thinner sports markets aren't dropped before matching).
poly_min_volume_usd = 100.0
poly_min_depth_usd = 0.0

[split]
# Enable the enhanced multi-outcome split arbitrage scanner (Strategy 1A).
# Detects bidirectional arbs: sum of asks < 1 (buy-and-merge) and
# sum of bids > 1 (split-and-sell). Analyses depth at $100/$500/$1K/$5K tiers.
enabled = true
# Enable live execution (false = paper mode, logs opportunities)
execute = false
# Minimum net edge after fees to report
min_net_edge = 0.005
# Scan interval in milliseconds
scan_interval_ms = 1000
# Max USDC per split position
max_position_usd = 500.0
# Max total USDC across all open split positions
max_total_exposure = 2000.0

[sniper]
# Enable the resolution sniping engine (Strategy 1B).
# Monitors external data sources and fires when an outcome becomes
# publicly knowable but the Polymarket book hasn't priced it in yet.
enabled = true
# Enable live execution (false = paper mode, logs estimated P&L)
execute = false
# Minimum confidence (0.0-1.0) to act on a resolution signal
min_confidence = 0.95
# Maximum price to pay for winning outcome tokens
max_buy_price = 0.99
# Enable crypto price threshold watching (uses existing exchange feeds)
crypto_enabled = true
# Poll interval for HTTP-based sources (Billboard, RT, USGS) in seconds
http_poll_interval_secs = 30

[lifecycle]
# Enable position lifecycle management (Strategy 1C).
# Manages exits: winning tokens queued for redemption, losing tokens
# drip-sold, stale positions sold at discount.
enabled = true
# Hours before a position is considered stale (triggers discount sell)
stale_threshold_hours = 24
# Shares per drip-sell batch (rate limits selling to avoid book impact)
drip_sell_batch = 1000.0
# Seconds between drip-sell batches
drip_sell_interval_secs = 35
# Tick interval for lifecycle checks (seconds)
tick_interval_secs = 10

[onchain]
# Enable on-chain event monitoring via Polygon WebSocket.
# Subscribes to CTF and UMA Oracle events for earliest possible signals
# on new market creation and resolution proposals.
enabled = true
# Polygon WebSocket RPC URL (also supports POLYGON_WS_URL env var).
# Options: Alchemy, QuickNode, Infura — e.g.:
#   wss://polygon-mainnet.g.alchemy.com/v2/{API_KEY}
#   wss://polygon-mainnet.quiknode.pro/{API_KEY}
polygon_ws_url = ""
# Gnosis CTF contract on Polygon (ConditionPreparation, ConditionResolution)
ctf_address = "0x4D97DCd97eC945f40cF65F87097ACe5EA0476045"
# Neg Risk CTF Exchange (TokenRegistered events)
neg_risk_ctf_exchange = "0xC5d563A36AE78145C45a50134d48A1215220f80a"
# Standard CTF Exchange (TokenRegistered events)
ctf_exchange = "0x4bFb41d5B3570DeFd03C39a9A4D8dE6Bd8B8982E"
# Neg Risk Adapter (PositionSplit/PositionsMerge events)
neg_risk_adapter = "0xd91E80cF2E7be2e162c6513ceD06f1dD0dA35296"
# UMA Optimistic Oracle V2 (ProposePrice/DisputePrice events)
# This is the Oracle contract, NOT the UmaCtfAdapter.
uma_oracle_adapter = "0xeE3Afe347D5C74317041E2618C49534dAf887c24"
# Alert if event processing latency exceeds this (ms)
max_latency_ms = 3000
# File to persist last processed block for gap recovery on restart
checkpoint_path = "onchain_checkpoint.txt"
# How many blocks back to scan on startup
startup_lookback_blocks = 100

[logging]
level = "info"
json = false
